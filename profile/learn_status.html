<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç¿’æ­·ç¨‹åˆ†æ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
</head>
<body>
    <header class="header">
        <div class="container">
          <div class="logo">
            <h1><a href="index.html#home">è³‡è¨±ä½ å®‰å…¨</a></h1>
          </div>
          <nav class="main-nav" role="navigation" aria-label="ä¸»è¦å°èˆª">
            <ul>
                <li><a href="index.html#home">é¦–é </a></li>
                <li><a href="index.html#about">é—œæ–¼æˆ‘å€‘</a></li>
                <li><a href="index.html#services">æœå‹™</a></li>
                <li><a href="learn_status.html"  class="active" aria-current="page">å­¸ç¿’æ­·ç¨‹åˆ†æ</a></li>
                <li><a href="/logout">ç™»å‡º</a></li>
            </ul>
          </nav>
        </div>
    </header>

    <section id="learning-analysis" class="learning-analysis">
        <div class="container">
            <br><br><br><br>
            <div class="chart-container">
                <h2>å„æƒ…å¢ƒéŒ¯èª¤æ¬¡æ•¸</h2>
                <canvas id="errorCountChart"></canvas>
            </div>
            <div class="chart-container">
                <h2>å„æƒ…å¢ƒå­¸ç¿’æ™‚é–“</h2>
                <canvas id="timeChart"></canvas>
            </div>
            <div class="chart-container">
                <h2>éŒ¯èª¤æ¬¡æ•¸ vs å­¸ç¿’æ™‚é–“æ•£ä½ˆåœ–</h2>
                <canvas id="scatterChart"></canvas>
            </div>
            <div class="summary-container">
                <h2>å­¸ç¿’ç¸½çµ</h2>
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-scenarios">-</div>
                            <div class="stat-label">å®Œæˆæƒ…å¢ƒ</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-time">-</div>
                            <div class="stat-label">ç¸½å­¸ç¿’æ™‚é–“</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="perfect-scenarios">-</div>
                            <div class="stat-label">å®Œç¾é€šé—œ</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="avg-errors">-</div>
                            <div class="stat-label">å¹³å‡éŒ¯èª¤æ¬¡æ•¸</div>
                        </div>
                    </div>
                </div>
                
                <div class="performance-analysis">
                    <h3>å­¸ç¿’è¡¨ç¾åˆ†æ</h3>
                    <div class="progress-bars">
                        <div class="progress-item">
                            <div class="progress-header">
                                <span>æ•´é«”æŒæ¡åº¦</span>
                                <span id="mastery-percentage">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="mastery-progress"></div>
                            </div>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-header">
                                <span>æ•ˆç‡æŒ‡æ¨™</span>
                                <span id="efficiency-percentage">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="efficiency-progress"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="detailed-summary">
                    <h3>è©³ç´°ç¸½çµ</h3>
                    <div class="summary-text" id="summary-text">è¼‰å…¥ä¸­...</div>
                    <div class="achievements" id="achievements-list">
                        <!-- æˆå°±åˆ—è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>è³‡è¨±ä½ å®‰å…¨</h2>
                    <p>æ²‰æµ¸å¼å­¸ç¿’ï¼Œè³‡å®‰æ•™è‚²</p>
                </div>
                <div class="footer-links">
                    <h3>å¿«é€Ÿå°è¦½</h3>
                    <ul>
                        <li><a href="index.html#home">é¦–é </a></li>
                        <li><a href="index.html#about">é—œæ–¼æˆ‘å€‘</a></li>
                        <li><a href="index.html#services">æœå‹™</a></li>
                        <li><a href="learn_status.html"  class="active" aria-current="page">å­¸ç¿’æ­·ç¨‹åˆ†æ</a></li>
                        <li><a href="/logout">ç™»å‡º</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>æ³•å¾‹è³‡è¨Š</h3>
                    <ul>
                      <li><a href="/views/privacy.html">éš±ç§æ¬Šæ”¿ç­–</a></li>
                      <li><a href="/views/tos.html">æœå‹™æ¢æ¬¾</a></li>
                    </ul>
                  </div>
                <div class="footer-social">
                    <h3>é—œæ³¨æˆ‘å€‘</h3>
                    <div class="social-icons">
                        <a href="https://github.com/Tkuim-111-is/Surecurity" class="social-icon"><img src="/static/images/github-mark-white.svg" alt="Github"></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 æ·¡æ±Ÿè³‡ç®¡. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©.</p>
            </div>
        </div>
    </footer>

    <script>
        function isTokenExpired(token) {
        if (!token) return true;
        try {
            const payload = JSON.parse(atob(token.split('.')[1]));
            return Date.now() / 1000 > payload.exp;
        } catch {
            return true;
        }
        }

        const token = localStorage.getItem('token');
        if (!token || isTokenExpired(token)) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
        }

        // å–å¾—å­¸ç¿’æ­·ç¨‹è³‡æ–™
        async function fetchLearnStatus() {
            try {
                const res = await fetch('/api/profile/learn_status', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const result = await res.json();
                if (result.success) {
                    const data = result.data;
                    renderCharts(data);
                    updateSummary(data);
                } else {
                    document.getElementById('summary-text').innerText = 'ç„¡æ³•å–å¾—å­¸ç¿’æ­·ç¨‹è³‡æ–™';
                }
            } catch (e) {
                document.getElementById('summary-text').innerText = 'è¼‰å…¥å­¸ç¿’æ­·ç¨‹å¤±æ•—';
                console.error('è¼‰å…¥å­¸ç¿’æ­·ç¨‹å¤±æ•—', e);
            }
        }

        // æ™‚é–“æ ¼å¼åŒ–å‡½æ•¸ï¼šç§’ -> åˆ†:ç§’
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // Context ID å°æ‡‰è¡¨
        const contextIdMapping = {
            2: 'æœƒè­°å®¤ç®¡ç†',
            4: 'ç„¡ç·šç¶²è·¯å®‰å…¨',
            6: 'å¤–ä¾†è£ç½®é¢¨éšª',
            71: 'å¯†ç¢¼å¼·åº¦',
            72: 'æ©Ÿå¯†æ–‡ä»¶ç®¡ç†',
            73: 'è³‡æ–™å¤–æ´©é¢¨éšª',
            74: 'æƒ¡æ„ç¶²ç«™',
            75: 'é‡£é­šéƒµä»¶é˜²ç¯„'
        };

        // Context ID æ ¼å¼åŒ–å‡½æ•¸ï¼šè½‰æ›ç‚ºä¸­æ–‡åç¨±
        function formatContextId(contextId) {
            return contextIdMapping[contextId] || `æƒ…å¢ƒ${contextId}`;
        }

        // æ—¥æœŸæ ¼å¼åŒ–å‡½æ•¸ï¼šå°‡ MySQL DATETIME è½‰æ›ç‚ºå¹´æœˆæ—¥æ ¼å¼
        function formatDate(dateString) {
            if (!dateString) return 'æœªçŸ¥æ™‚é–“';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('zh-TW', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                });
            } catch (e) {
                return 'ç„¡æ•ˆæ™‚é–“';
            }
        }

        // æ ¹æ“šè³‡æ–™æ¸²æŸ“åœ–è¡¨
        function renderCharts(data) {
            // context_id ä»£è¡¨é—œå¡ï¼Œerr_count ä»£è¡¨éŒ¯èª¤æ¬¡æ•¸ï¼Œtime_record ä»£è¡¨å­¸ç¿’æ™‚é–“
            const contextLabels = [...new Set(data.map(row => row.context_id))];
            const formattedContextLabels = contextLabels.map(label => formatContextId(label));
            
            // ç‚ºæ¯å€‹ context æº–å‚™è³‡æ–™å’Œå®Œæˆæ™‚é–“
            const contextData = contextLabels.map(label => {
                const contextRows = data.filter(row => row.context_id === label);
                const totalTime = contextRows.reduce((sum, row) => sum + (row.time_record || 0), 0);
                const totalErrors = contextRows.reduce((sum, row) => sum + row.err_count, 0);
                
                // æ‰¾åˆ°æœ€æ–°çš„è¨˜éŒ„ï¼ˆæ ¹æ“š created_atï¼‰
                const latestRecord = contextRows.reduce((latest, row) => {
                    return new Date(row.created_at) > new Date(latest.created_at) ? row : latest;
                }, contextRows[0]);
                
                // æ‰¾åˆ°æœ€ä½³è¨˜éŒ„ï¼ˆæœ€å°‘éŒ¯èª¤æ¬¡æ•¸ï¼‰
                const bestRecord = contextRows.reduce((best, row) => {
                    return row.err_count < best.err_count ? row : best;
                }, contextRows[0]);
                
                return {
                    contextId: label,
                    formattedId: formatContextId(label),
                    totalTime,
                    totalErrors,
                    completedAt: latestRecord.created_at,
                    latestErrorCount: latestRecord.err_count,  // æœ€æ–°è¨˜éŒ„çš„éŒ¯èª¤æ¬¡æ•¸
                    bestErrorCount: bestRecord.err_count,      // æœ€ä½³è¨˜éŒ„çš„éŒ¯èª¤æ¬¡æ•¸
                    isPerfectLatest: latestRecord.err_count === 0,  // æœ€æ–°è¨˜éŒ„æ˜¯å¦å®Œç¾
                    isPerfectBest: bestRecord.err_count === 0       // æ˜¯å¦æœ‰å®Œç¾è¨˜éŒ„
                };
            });
            
            const learningTimes = contextData.map(item => item.totalTime);
            const errorRates = contextData.map(item => item.totalErrors);

            // å„é—œå¡éŒ¯èª¤æ¬¡æ•¸åœ–è¡¨
            new Chart(document.getElementById('errorCountChart'), {
                type: 'bar',
                data: {
                    labels: formattedContextLabels,
                    datasets: [{
                        label: 'éŒ¯èª¤æ¬¡æ•¸',
                        data: errorRates,
                        backgroundColor: '#f43f5e',
                        borderColor: '#b91c1c',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: true, position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    const contextInfo = contextData[index];
                                    return contextInfo.formattedId;
                                },
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const contextInfo = contextData[index];
                                    const completedDate = formatDate(contextInfo.completedAt);
                                    return [
                                        `éŒ¯èª¤æ¬¡æ•¸: ${context.parsed.y}`,
                                        `å®Œæˆæ™‚é–“: ${completedDate}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // å„é—œå¡å­¸ç¿’æ™‚é–“åœ–è¡¨
            new Chart(document.getElementById('timeChart'), {
                type: 'bar',
                data: {
                    labels: formattedContextLabels,
                    datasets: [{
                        label: 'å­¸ç¿’æ™‚é–“ (ç§’)',
                        data: learningTimes,
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: true, position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    const contextInfo = contextData[index];
                                    return contextInfo.formattedId;
                                },
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const contextInfo = contextData[index];
                                    const seconds = context.parsed.y;
                                    const completedDate = formatDate(contextInfo.completedAt);
                                    return [
                                        `å­¸ç¿’æ™‚é–“: ${formatTime(seconds)} (${seconds}ç§’)`,
                                        `å®Œæˆæ™‚é–“: ${completedDate}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatTime(value);
                                }
                            }
                        }
                    }
                }
            });

            // éŒ¯èª¤æ¬¡æ•¸ vs å­¸ç¿’æ™‚é–“æ•£ä½ˆåœ–
            const scatterData = data.map(row => ({
                x: row.err_count,
                y: row.time_record,
                context_id: row.context_id
            }));

            // æŒ‰ context_id åˆ†çµ„é¡¯ç¤ºä¸åŒé¡è‰²
            const contexts = [...new Set(data.map(row => row.context_id))];
            const colors = ['#f43f5e', '#3b82f6', '#10b981', '#f59e0b', '#8b5cf6', '#ef4444', '#06b6d4', '#84cc16'];
            
            const scatterDatasets = contexts.map((context, index) => ({
                label: formatContextId(context),
                data: scatterData.filter(point => point.context_id === context),
                backgroundColor: colors[index % colors.length],
                borderColor: colors[index % colors.length],
                pointRadius: 8,
                pointHoverRadius: 10
            }));

            new Chart(document.getElementById('scatterChart'), {
                type: 'scatter',
                data: {
                    datasets: scatterDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { 
                            display: true, 
                            position: 'bottom' 
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const datasetIndex = context[0].datasetIndex;
                                    const dataIndex = context[0].dataIndex;
                                    const dataset = scatterDatasets[datasetIndex];
                                    const dataPoint = dataset.data[dataIndex];
                                    const contextInfo = contextData.find(item => item.contextId === dataPoint.context_id);
                                    return contextInfo ? contextInfo.formattedId : formatContextId(dataPoint.context_id);
                                },
                                label: function(context) {
                                    const datasetIndex = context.datasetIndex;
                                    const dataIndex = context.dataIndex;
                                    const dataset = scatterDatasets[datasetIndex];
                                    const dataPoint = dataset.data[dataIndex];
                                    const contextInfo = contextData.find(item => item.contextId === dataPoint.context_id);
                                    const point = context.parsed;
                                    const timeFormatted = formatTime(point.y);
                                    const completedDate = formatDate(contextInfo ? contextInfo.completedAt : '');
                                    return [
                                        `éŒ¯èª¤æ¬¡æ•¸: ${point.x}`,
                                        `å­¸ç¿’æ™‚é–“: ${timeFormatted} (${point.y}ç§’)`,
                                        `å®Œæˆæ™‚é–“: ${completedDate}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'éŒ¯èª¤æ¬¡æ•¸ (err_count)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'å­¸ç¿’æ™‚é–“ (time_record)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatTime(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°å­¸ç¿’ç¸½çµ
        function updateSummary(data) {
            const totalTimeSeconds = data.reduce((sum, row) => sum + (row.time_record || 0), 0);
            const totalErr = data.reduce((sum, row) => sum + row.err_count, 0);
            const averageErrorRate = data.length > 0 ? (totalErr / data.length).toFixed(2) : 0;
            const totalTimeFormatted = formatTime(totalTimeSeconds);
            
            // è¨ˆç®—çµ±è¨ˆè³‡æ–™
            const contextLabels = [...new Set(data.map(row => row.context_id))];
            const totalScenarios = contextLabels.length;
            
            // è¨ˆç®—å®Œç¾é€šé—œæ•¸é‡ï¼ˆéŒ¯èª¤æ¬¡æ•¸ç‚º0çš„æƒ…å¢ƒï¼‰
            const perfectScenarios = contextLabels.filter(contextId => {
                const contextRows = data.filter(row => row.context_id === contextId);
                const bestRecord = contextRows.reduce((best, row) => {
                    return row.err_count < best.err_count ? row : best;
                }, contextRows[0]);
                return bestRecord.err_count === 0;
            }).length;
            
            // è¨ˆç®—æŒæ¡åº¦ï¼ˆåŸºæ–¼éŒ¯èª¤æ¬¡æ•¸ï¼‰
            const masteryScore = totalScenarios > 0 ? Math.max(0, 100 - (averageErrorRate * 10)) : 0;
            
            // è¨ˆç®—æ•ˆç‡æŒ‡æ¨™ï¼ˆåŸºæ–¼æ™‚é–“å’ŒéŒ¯èª¤æ¬¡æ•¸çš„ç¶œåˆè©•ä¼°ï¼‰
            const avgTimePerScenario = totalScenarios > 0 ? totalTimeSeconds / totalScenarios : 0;
            const timeEfficiency = Math.max(0, 100 - (avgTimePerScenario / 60) * 5); // å‡è¨­ç†æƒ³æ™‚é–“ç‚º1åˆ†é˜
            const errorEfficiency = Math.max(0, 100 - averageErrorRate * 20);
            const overallEfficiency = (timeEfficiency + errorEfficiency) / 2;
            
            // æ›´æ–°çµ±è¨ˆå¡ç‰‡
            document.getElementById('total-scenarios').textContent = totalScenarios;
            document.getElementById('total-time').textContent = totalTimeFormatted;
            document.getElementById('perfect-scenarios').textContent = `${perfectScenarios}/${totalScenarios}`;
            document.getElementById('avg-errors').textContent = averageErrorRate;
            
            // æ›´æ–°é€²åº¦æ¢
            document.getElementById('mastery-percentage').textContent = `${Math.round(masteryScore)}%`;
            document.getElementById('mastery-progress').style.width = `${masteryScore}%`;
            
            document.getElementById('efficiency-percentage').textContent = `${Math.round(overallEfficiency)}%`;
            document.getElementById('efficiency-progress').style.width = `${overallEfficiency}%`;
            
            // æ›´æ–°è©³ç´°ç¸½çµæ–‡å­—
            const summaryText = generateDetailedSummary(data, totalTimeFormatted, averageErrorRate, totalScenarios, perfectScenarios, masteryScore, overallEfficiency);
            document.getElementById('summary-text').innerHTML = summaryText;
            
            // ç”Ÿæˆæˆå°±åˆ—è¡¨
            generateAchievements(data, totalScenarios, perfectScenarios, totalTimeSeconds, averageErrorRate);
        }
        
        // ç”Ÿæˆè©³ç´°ç¸½çµæ–‡å­—
        function generateDetailedSummary(data, totalTime, avgErrors, totalScenarios, perfectScenarios, masteryScore, efficiency) {
            let summary = `<strong>å­¸ç¿’æ¦‚æ³ï¼š</strong><br>`;
            summary += `ä½ ç¸½å…±å®Œæˆäº† <span style="color: var(--primary-600); font-weight: 700;">${totalScenarios}</span> å€‹è³‡å®‰æƒ…å¢ƒçš„å­¸ç¿’ï¼Œ`;
            summary += `ç´¯è¨ˆå­¸ç¿’æ™‚é–“ç‚º <span style="color: var(--primary-600); font-weight: 700;">${totalTime}</span>ã€‚<br><br>`;
            
            summary += `<strong>è¡¨ç¾åˆ†æï¼š</strong><br>`;
            if (perfectScenarios > 0) {
                summary += `ğŸ‰ æ­å–œï¼ä½ åœ¨ <span style="color: var(--success-600); font-weight: 700;">${perfectScenarios}</span> å€‹æƒ…å¢ƒä¸­é”åˆ°äº†å®Œç¾é€šé—œï¼ˆé›¶éŒ¯èª¤ï¼‰ï¼<br>`;
            }
            
            summary += `å¹³å‡æ¯å€‹æƒ…å¢ƒçš„éŒ¯èª¤æ¬¡æ•¸ç‚º <span style="color: ${avgErrors <= 1 ? 'var(--success-600)' : avgErrors <= 3 ? 'var(--warning-600)' : 'var(--danger-600)'}; font-weight: 700;">${avgErrors}</span> æ¬¡ã€‚<br><br>`;
            
            // æ ¹æ“šè¡¨ç¾çµ¦å‡ºå»ºè­°
            if (masteryScore >= 80) {
                summary += `<strong>ğŸŒŸ å„ªç§€è¡¨ç¾ï¼š</strong>ä½ çš„æŒæ¡åº¦é”åˆ°äº† ${Math.round(masteryScore)}%ï¼Œè¡¨ç¾éå¸¸å‡ºè‰²ï¼ç¹¼çºŒä¿æŒé€™ç¨®å­¸ç¿’æ…‹åº¦ã€‚`;
            } else if (masteryScore >= 60) {
                summary += `<strong>ğŸ“ˆ è‰¯å¥½é€²æ­¥ï¼š</strong>ä½ çš„æŒæ¡åº¦ç‚º ${Math.round(masteryScore)}%ï¼Œå·²ç¶“æœ‰äº†ä¸éŒ¯çš„åŸºç¤ï¼Œå»ºè­°å¤šè¤‡ç¿’éŒ¯èª¤è¼ƒå¤šçš„æƒ…å¢ƒã€‚`;
            } else {
                summary += `<strong>ğŸ’ª æŒçºŒåŠªåŠ›ï¼š</strong>ä½ çš„æŒæ¡åº¦ç‚º ${Math.round(masteryScore)}%ï¼Œé‚„æœ‰å¾ˆå¤§çš„æå‡ç©ºé–“ï¼Œå»ºè­°é‡è¤‡ç·´ç¿’ä¸¦ä»”ç´°é–±è®€ç›¸é—œè³‡å®‰çŸ¥è­˜ã€‚`;
            }
            
            return summary;
        }
        
        // ç”Ÿæˆæˆå°±åˆ—è¡¨
        function generateAchievements(data, totalScenarios, perfectScenarios, totalTimeSeconds, avgErrors) {
            const achievementsContainer = document.getElementById('achievements-list');
            const achievements = [];
            
            // å®Œæˆæƒ…å¢ƒæˆå°±
            if (totalScenarios >= 8) {
                achievements.push({
                    icon: 'ğŸ†',
                    type: 'gold',
                    text: 'è³‡å®‰å°ˆå®¶ - å®Œæˆæ‰€æœ‰å­¸ç¿’æƒ…å¢ƒ'
                });
            } else if (totalScenarios >= 5) {
                achievements.push({
                    icon: 'ğŸ¥ˆ',
                    type: 'silver', 
                    text: `æƒ…å¢ƒæ¢ç´¢è€… - å®Œæˆ ${totalScenarios} å€‹å­¸ç¿’æƒ…å¢ƒ`
                });
            } else if (totalScenarios >= 3) {
                achievements.push({
                    icon: 'ğŸ¥‰',
                    type: 'bronze',
                    text: `å­¸ç¿’æ–°æ‰‹ - å®Œæˆ ${totalScenarios} å€‹å­¸ç¿’æƒ…å¢ƒ`
                });
            }
            
            // å®Œç¾é€šé—œæˆå°±
            if (perfectScenarios >= 5) {
                achievements.push({
                    icon: 'â­',
                    type: 'gold',
                    text: `å®Œç¾ä¸»ç¾©è€… - ${perfectScenarios} æ¬¡å®Œç¾é€šé—œ`
                });
            } else if (perfectScenarios >= 3) {
                achievements.push({
                    icon: 'âœ¨',
                    type: 'silver',
                    text: `ç²¾æº–å°„æ‰‹ - ${perfectScenarios} æ¬¡å®Œç¾é€šé—œ`
                });
            } else if (perfectScenarios >= 1) {
                achievements.push({
                    icon: 'ğŸ’«',
                    type: 'bronze',
                    text: `åˆéœ²é‹’èŠ’ - ${perfectScenarios} æ¬¡å®Œç¾é€šé—œ`
                });
            }
            
            // å­¸ç¿’æ™‚é–“æˆå°±
            const totalMinutes = Math.floor(totalTimeSeconds / 60);
            if (totalMinutes >= 60) {
                achievements.push({
                    icon: 'â°',
                    type: 'gold',
                    text: `å­¸ç¿’é¦¬æ‹‰æ¾ - ç´¯è¨ˆå­¸ç¿’è¶…é 1 å°æ™‚`
                });
            } else if (totalMinutes >= 30) {
                achievements.push({
                    icon: 'ğŸ•',
                    type: 'silver',
                    text: `å°ˆæ³¨å­¸ç¿’è€… - ç´¯è¨ˆå­¸ç¿’è¶…é 30 åˆ†é˜`
                });
            } else if (totalMinutes >= 10) {
                achievements.push({
                    icon: 'â±ï¸',
                    type: 'bronze',
                    text: `æ™‚é–“æŠ•è³‡è€… - ç´¯è¨ˆå­¸ç¿’è¶…é 10 åˆ†é˜`
                });
            }
            
            // éŒ¯èª¤ç‡æˆå°±
            if (avgErrors <= 1) {
                achievements.push({
                    icon: 'ğŸ¯',
                    type: 'gold',
                    text: 'ç¥å°„æ‰‹ - å¹³å‡éŒ¯èª¤æ¬¡æ•¸æ¥µä½'
                });
            } else if (avgErrors <= 2) {
                achievements.push({
                    icon: 'ğŸ¹',
                    type: 'silver',
                    text: 'æº–ç¢ºå°„æ‰‹ - å¹³å‡éŒ¯èª¤æ¬¡æ•¸è¼ƒä½'
                });
            }
            
            // æ¸²æŸ“æˆå°±
            if (achievements.length === 0) {
                achievementsContainer.innerHTML = '<p style="text-align: center; color: var(--gray-500); font-style: italic;">ç¹¼çºŒå­¸ç¿’ä»¥è§£é–æ›´å¤šæˆå°±ï¼</p>';
            } else {
                achievementsContainer.innerHTML = achievements.map(achievement => `
                    <div class="achievement-item">
                        <div class="achievement-icon ${achievement.type}">
                            ${achievement.icon}
                        </div>
                        <div class="achievement-text">
                            ${achievement.text}
                        </div>
                    </div>
                `).join('');
            }
        }

        // åˆå§‹åŒ–
        fetchLearnStatus();
    </script>
</body>
</html>